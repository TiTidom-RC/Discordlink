<div class="cmd cmd-widget reportModeHidden" data-type="action" data-subtype="message" data-template="default"
    data-cmd_id="#id#" data-cmd_uid="#uid#" data-version="#version#" data-eqLogic_id="#eqLogic_id#">
    <div class="title #hide_name#">
        <div class="cmdName">#name_display#</div>
    </div>
    <div class="content-sm" style="padding: 8px; border: 1px solid rgba(128,128,128,0.5); border-radius: 4px;">
        <div style="margin-bottom: 5px;">
            <input type="text" class="form-control input-sm embedTitle" placeholder="Titre" data-cmd_uid="#uid#"
                data-cmd_id="#id#" style="margin-bottom: 3px;">
        </div>
        <div style="margin-bottom: 5px;">
            <textarea class="form-control input-sm embedDescription" rows="2" placeholder="Description (message)"
                data-cmd_uid="#uid#" data-cmd_id="#id#" style="margin-bottom: 3px;"></textarea>
        </div>
        <div style="margin-bottom: 5px;">
            <input type="text" class="form-control input-sm embedUrl" placeholder="URL (optionnel)" data-cmd_uid="#uid#"
                data-cmd_id="#id#" style="margin-bottom: 3px;">
        </div>
        <div style="margin-bottom: 5px;">
            <input type="text" class="form-control input-sm embedFooter" placeholder="Footer (optionnel)"
                data-cmd_uid="#uid#" data-cmd_id="#id#" style="margin-bottom: 3px;">
        </div>
        <div style="margin-bottom: 5px; display: flex; gap: 5px;">
            <input type="color" class="form-control input-sm embedColorPicker" data-cmd_uid="#uid#"
                style="width: 50px; padding: 2px;">
            <input type="text" class="form-control input-sm embedColor" placeholder="Couleur (Hexa)"
                data-cmd_uid="#uid#" data-cmd_id="#id#" style="flex: 1;">
        </div>
        <div style="text-align: center;">
            <a class="btn btn-sm btn-success executeEmbed" style="width: 100%;">
                <i class="fas fa-paper-plane"></i> #name_display#
            </a>
        </div>
    </div>

    <script>
        // Charger la couleur par défaut depuis la configuration de l'équipement
        (function () {
            jeedom.eqLogic.byId({
                id: '#eqLogic_id#',
                error: function (error) {
                    console.error('Erreur chargement équipement:', error);
                },
                success: function (data) {
                    let defaultColor = data.configuration.defaultColor || '#0099ff';
                    document.querySelector('.cmd[data-cmd_uid="#uid#"] .embedColorPicker').value = defaultColor;
                    document.querySelector('.cmd[data-cmd_uid="#uid#"] .embedColor').value = defaultColor;
                }
            });
        })();

        // Synchroniser le color picker avec le champ texte
        document.querySelector('.cmd[data-cmd_uid="#uid#"] .embedColorPicker').addEventListener('change', function () {
            document.querySelector('.cmd[data-cmd_uid="#uid#"] .embedColor').value = this.value;
        });

        document.querySelector('.cmd[data-cmd_uid="#uid#"] .embedColor').addEventListener('input', function () {
            let color = this.value;
            if (color.match(/^#[0-9A-Fa-f]{6}$/)) {
                document.querySelector('.cmd[data-cmd_uid="#uid#"] .embedColorPicker').value = color;
            }
        });

        // Gérer le masquage du titre
        if ('#title_disable#' == '1') {
            document.querySelector('.cmd[data-cmd_uid="#uid#"] .title').style.display = 'none';
        }

        // Exécuter la commande
        document.querySelector('.cmd[data-cmd_uid="#uid#"] .executeEmbed').addEventListener('click', function () {
            let options = {
                title: document.querySelector('.cmd[data-cmd_uid="#uid#"] .embedTitle').value,
                description: document.querySelector('.cmd[data-cmd_uid="#uid#"] .embedDescription').value,
                url: document.querySelector('.cmd[data-cmd_uid="#uid#"] .embedUrl').value,
                footer: document.querySelector('.cmd[data-cmd_uid="#uid#"] .embedFooter').value,
                colors: document.querySelector('.cmd[data-cmd_uid="#uid#"] .embedColor').value
            };

            jeedom.cmd.execute({
                id: '#id#',
                value: options
            });
        });
    </script>
</div>